rules:
  graph:
    - code: PB001
      name: non-unique-initializer-name
      category: protobuf
      severity: error
      message: Tensor initializer names within a graph are not unique.
      suggestion: Rename the tensor initializers or remove the duplicates.
      explanation: |
        Tensor initializer names within a graph must be unique.

        To fix this issue, rename the tensor initializers or remove the duplicates.

    - code: PB002
      name: non-unique-sparse-initializer-name
      category: protobuf
      severity: error
      message: Sparse tensor initializer names are not unique.
      suggestion: Rename the sparse tensor initializers to ensure uniqueness.
      explanation: |
        Sparse tensor initializer names within a GraphProto must be unique
        across both initializers and sparse initializers.

  node:
    # Attribute-related rules (emitted against containing node)
    - code: PB003
      name: attribute-multiple-value-fields
      category: protobuf
      severity: error
      message: Attribute contains more than one value field.
      suggestion: Set only one value field on the attribute.
      explanation: |
        In protobuf, an attribute should contain exactly one value field.
        This is enforced by the IR type system and cannot occur with onnx_ir.

    - code: PB004
      name: attribute-ref-has-value
      category: protobuf
      severity: error
      message: Attribute referring to a parent attribute has its own value field set.
      suggestion: Remove the value field from the reference attribute.
      explanation: |
        An attribute that references a parent attribute (ref_attr_name is set)
        should not have its own value field. In onnx_ir, Attr.is_ref()
        distinguishes reference attributes.

  value:
    # Tensor-related rules (emitted against containing value/node)
    - code: PB005
      name: tensor-data-field-mismatch
      category: protobuf
      severity: error
      message: Tensor data field does not match the specified data type.
      suggestion: Ensure the data is stored in the correct field for the tensor's dtype.
      explanation: |
        The data field of a TensorProto must match the specified data_type.

    - code: PB006
      name: zero-element-tensor-has-data
      category: protobuf
      severity: error
      message: A zero-element tensor should not contain data.
      suggestion: Remove the data from the zero-element tensor.
      explanation: |
        A tensor with zero elements should not contain any data fields.

    - code: PB007
      name: multi-value-field-tensor
      category: protobuf
      severity: error
      message: Tensor with non-zero elements has multiple value fields set.
      suggestion: Use exactly one value field to store the tensor data.
      explanation: |
        A tensor with non-zero elements should contain exactly one value field.

    - code: PB008
      name: string-data-in-raw-data
      category: protobuf
      severity: error
      message: STRING data stored in raw_data field.
      suggestion: Store string data in the string_data field instead.
      explanation: |
        STRING data should not be stored in the raw_data field of a TensorProto.

    - code: PB009
      name: externally-stored-tensor-has-data
      category: protobuf
      severity: error
      message: Externally stored tensor has inline data fields set.
      suggestion: Remove the inline data fields from the externally stored tensor.
      explanation: |
        Tensors stored externally should not have any inline data fields set.

    - code: PB010
      name: invalid-sparse-indices-size
      category: protobuf
      severity: error
      message: Sparse tensor indices size does not match NNZ count.
      suggestion: Ensure the indices match the number of non-zero elements.
      explanation: |
        The size of the indices field in a SparseTensorProto must match
        the number of non-zero elements (NNZ).

    - code: PB011
      name: sparse-indices-out-of-range
      category: protobuf
      severity: error
      message: Sparse tensor indices are out of range.
      suggestion: Ensure all indices are within the tensor's dimensions.
      explanation: |
        All indices in a SparseTensorProto must be within the valid range
        defined by the tensor's shape.

    - code: PB012
      name: unsorted-sparse-indices
      category: protobuf
      severity: error
      message: Sparse tensor indices are not sorted.
      suggestion: Sort the sparse tensor indices.
      explanation: |
        Indices in a SparseTensorProto must be in sorted order.

    - code: PB013
      name: sparse-indices-not-lexicographic
      category: protobuf
      severity: error
      message: Sparse tensor indices are not in lexicographic order.
      suggestion: Sort the sparse tensor indices in lexicographic order.
      explanation: |
        Multi-dimensional indices in a SparseTensorProto must be in
        lexicographic sorted order.
